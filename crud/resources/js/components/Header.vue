<template>
    <div>
        <b-navbar class="header__nav" toggleable="lg"  type="dark" variant="info">
            <div class="container">
                <b-navbar-brand to="/">
                    <svg class="header__logo" xmlns="http://www.w3.org/2000/svg" width="118" height="69" viewBox="0 0 118 69" fill="none"><path d="M2.85938 15.6562C2.48438 15.7812 2.20312 15.7969 2.01562 15.7031C1.82812 15.6094 1.6875 15.4531 1.59375 15.2344C1.5 15.0156 1.45312 14.7813 1.45312 14.5312C1.45312 14.25 1.46875 13.9844 1.5 13.7344C1.53125 13.5156 1.57812 13.2656 1.64062 12.9844C1.73438 12.7031 1.84375 12.4375 1.96875 12.1875C2.09375 11.9375 2.23438 11.7344 2.39062 11.5781C2.57812 11.3906 2.8125 11.2656 3.09375 11.2031C4.53125 10.9531 5.92188 10.7656 7.26562 10.6406C8.64062 10.5156 9.875 10.4219 10.9688 10.3594C12.2188 10.2656 13.4219 10.2188 14.5781 10.2188C14.8281 10.2188 15.0781 10.2344 15.3281 10.2656C15.5781 10.2656 15.8281 10.2656 16.0781 10.2656C16.3594 10.2031 16.5781 10.1875 16.7344 10.2188C16.9219 10.2188 17.0781 10.2344 17.2031 10.2656C18.1094 10.2969 19.0469 10.3437 20.0156 10.4062C20.8281 10.4688 21.7344 10.5469 22.7344 10.6406C23.7656 10.7031 24.7812 10.7969 25.7812 10.9219C25.875 11.1719 25.8906 11.4844 25.8281 11.8594C25.7969 12.0469 25.7656 12.2344 25.7344 12.4219C25.7031 12.6094 25.625 12.7812 25.5 12.9375C25.4062 13.0938 25.2812 13.25 25.125 13.4062C25 13.5312 24.8438 13.6406 24.6562 13.7344C23.5938 13.7031 22.5625 13.6875 21.5625 13.6875C20.5938 13.6563 19.7344 13.6406 18.9844 13.6406H16.4531C16.0469 15.0781 15.5469 16.8594 14.9531 18.9844C14.3594 21.0781 13.75 23.2969 13.125 25.6406C12.5312 27.9531 11.9531 30.2656 11.3906 32.5781C10.8594 34.8594 10.4375 36.9219 10.125 38.7656C9.8125 40.5469 9.5 42.2969 9.1875 44.0156C9.0625 44.7344 8.92188 45.4844 8.76562 46.2656C8.64062 47.0469 8.51562 47.8125 8.39062 48.5625C8.29688 49.3125 8.20312 50.0312 8.10938 50.7188C8.01562 51.4062 7.9375 52.0312 7.875 52.5938C7.375 52.8438 6.90625 53.0312 6.46875 53.1562C6.03125 53.3125 5.64062 53.4219 5.29688 53.4844C4.89062 53.5781 4.51562 53.625 4.17188 53.625C3.42188 53.625 2.95312 53.5312 2.76562 53.3438C2.60938 53.1875 2.59375 52.8594 2.71875 52.3594C2.8125 51.9219 3.09375 50.7344 3.5625 48.7969C3.75 47.9844 3.98438 46.9531 4.26562 45.7031C4.57812 44.4844 4.9375 43 5.34375 41.25C5.75 39.4688 6.23438 37.4062 6.79688 35.0625C7.35938 32.6875 8 29.9688 8.71875 26.9062L11.8594 13.875C10.9219 14 10 14.1406 9.09375 14.2969C8.1875 14.4531 7.32812 14.625 6.51562 14.8125C5.73438 14.9688 5.01562 15.125 4.35938 15.2812C3.73438 15.4375 3.23438 15.5625 2.85938 15.6562ZM34.2188 37.5469C33.9062 38.7344 33.4844 39.8438 32.9531 40.875C32.4219 41.9062 31.7812 42.7969 31.0312 43.5469C30.3125 44.2969 29.4844 44.875 28.5469 45.2812C27.6406 45.7188 26.6406 45.9375 25.5469 45.9375C24.2656 45.9375 23.25 45.6562 22.5 45.0938C21.7812 44.5625 21.2344 43.8906 20.8594 43.0781C20.5156 42.2656 20.3125 41.375 20.25 40.4062C20.1562 39.4375 20.1094 38.5312 20.1094 37.6875C20.1094 37.0938 20.1875 36.4375 20.3438 35.7188C20.4688 35 20.6562 34.2656 20.9062 33.5156C21.1562 32.7656 21.4688 32.0156 21.8438 31.2656C22.25 30.5156 22.7188 29.8281 23.25 29.2031C23.4375 28.6719 23.7188 28.2031 24.0938 27.7969C24.5 27.3906 24.9531 27.0625 25.4531 26.8125C25.9844 26.5312 26.5469 26.3281 27.1406 26.2031C27.7344 26.0469 28.3125 25.9688 28.875 25.9688C28.9688 25.9688 29.0469 25.9844 29.1094 26.0156C29.2031 26.0469 29.2969 26.0781 29.3906 26.1094C29.7969 26.1406 30.2969 26.2969 30.8906 26.5781C31.5156 26.8594 32.1094 27.2812 32.6719 27.8438C33.2656 28.4062 33.7656 29.125 34.1719 30C34.5781 30.8438 34.7812 31.875 34.7812 33.0938C34.7812 33.3438 34.7656 33.6562 34.7344 34.0312C34.7031 34.375 34.6719 34.6719 34.6406 34.9219C35.3594 34.6406 36.1094 34.2969 36.8906 33.8906C37.6719 33.4844 38.4219 33.0625 39.1406 32.625C39.8906 32.1562 40.5781 31.6875 41.2031 31.2188C41.8281 30.75 42.3281 30.3281 42.7031 29.9531C43.0156 29.6719 43.2812 29.5156 43.5 29.4844C43.7188 29.4531 43.875 29.5156 43.9688 29.6719C44.0625 29.8281 44.0781 30.0469 44.0156 30.3281C43.9531 30.6094 43.7812 30.9219 43.5 31.2656C43.3438 31.4531 42.9375 31.8281 42.2812 32.3906C41.6562 32.9531 40.9062 33.5625 40.0312 34.2188C39.1562 34.875 38.2031 35.5156 37.1719 36.1406C36.1406 36.7656 35.1562 37.2344 34.2188 37.5469ZM26.2969 30.4219C26.2031 30.7031 26.1562 31 26.1562 31.3125C26.1562 31.8125 26.1875 32.3438 26.25 32.9062C26.3125 33.4375 26.4688 33.9219 26.7188 34.3594C26.9688 34.7969 27.3594 35.1719 27.8906 35.4844C28.4531 35.7656 29.2188 35.9062 30.1875 35.9062C30.3438 35.9062 30.5 35.9062 30.6562 35.9062C30.8125 35.875 30.9688 35.8438 31.125 35.8125C31.2188 35.4062 31.2969 35.0469 31.3594 34.7344C31.4531 34.3906 31.5 34.0938 31.5 33.8438C31.5625 33.25 31.5625 32.6406 31.5 32.0156C31.4375 31.3906 31.3125 30.8281 31.125 30.3281C30.9688 29.7969 30.75 29.375 30.4688 29.0625C30.2188 28.7188 29.9062 28.5469 29.5312 28.5469C28.9375 28.5469 28.3594 28.7188 27.7969 29.0625C27.2656 29.375 26.7656 29.8281 26.2969 30.4219ZM23.2969 38.6719C23.2969 39.2344 23.3281 39.7969 23.3906 40.3594C23.4531 40.8906 23.5781 41.375 23.7656 41.8125C23.9531 42.2188 24.2031 42.5625 24.5156 42.8438C24.8281 43.0938 25.2344 43.2188 25.7344 43.2188C26.2969 43.2188 26.8125 43.0938 27.2812 42.8438C27.75 42.5625 28.1719 42.2188 28.5469 41.8125C28.9219 41.375 29.25 40.8906 29.5312 40.3594C29.8438 39.7969 30.1094 39.2188 30.3281 38.625C30.1094 38.6562 29.8906 38.6875 29.6719 38.7188C29.4844 38.7188 29.2656 38.7188 29.0156 38.7188C27.8281 38.7188 26.7969 38.375 25.9219 37.6875C25.0781 36.9688 24.4219 36.0625 23.9531 34.9688C23.7656 35.625 23.6094 36.2656 23.4844 36.8906C23.3594 37.5156 23.2969 38.1094 23.2969 38.6719ZM52.875 51.0469C52.5938 50.8594 52.4531 50.6562 52.4531 50.4375C52.4219 50.2188 52.4688 50 52.5938 49.7812C52.7188 49.5312 52.9062 49.2812 53.1562 49.0312C53.4062 48.8125 53.7031 48.25 54.0469 47.3438C54.3906 46.4688 54.75 45.4062 55.125 44.1562C55.5312 42.875 55.9219 41.4844 56.2969 39.9844C56.7031 38.4844 57.0781 37.0156 57.4219 35.5781C57.7656 34.1406 58.0625 32.8125 58.3125 31.5938C58.5625 30.375 58.75 29.4062 58.875 28.6875C59.0312 27.8125 59.2031 26.8594 59.3906 25.8281C59.5469 24.9219 59.7188 23.875 59.9062 22.6875C60.0938 21.4688 60.2656 20.125 60.4219 18.6562L64.1719 16.9688C64.7031 16.7188 65.0781 16.7812 65.2969 17.1562C65.5156 17.5 65.5156 18.2344 65.2969 19.3594C65.2031 19.9219 65.0312 20.8438 64.7812 22.125C64.5312 23.375 64.2344 24.7656 63.8906 26.2969C63.5781 27.7969 63.2344 29.3438 62.8594 30.9375C62.5156 32.5 62.1719 33.8906 61.8281 35.1094C61.5156 36.2656 61.1562 37.5938 60.75 39.0938C60.0312 41.6562 59.0312 45.1562 57.75 49.5938C58.1875 50.3438 59 50.7188 60.1875 50.7188C61.5 50.7188 63.0156 50.2188 64.7344 49.2188C66.4844 48.2188 68.1719 46.7188 69.7969 44.7188C71.4219 42.7188 72.8438 40.2188 74.0625 37.2188C75.3125 34.1875 76.0938 30.6562 76.4062 26.625C76.5625 24.4375 76.4531 22.5156 76.0781 20.8594C75.7031 19.2031 75.125 17.8125 74.3438 16.6875C73.5938 15.5625 72.6562 14.7188 71.5312 14.1562C70.4375 13.5938 69.2188 13.3125 67.875 13.3125C64.7188 13.3125 61.4531 14.625 58.0781 17.25L57.8438 13.3594C58.6562 12.4531 59.5781 11.7656 60.6094 11.2969C61.6719 10.7969 62.6562 10.4219 63.5625 10.1719C64.625 9.89062 65.7031 9.73437 66.7969 9.70312C68.7969 9.70312 70.7188 10.0938 72.5625 10.875C74.4375 11.625 76.0469 12.7812 77.3906 14.3438C78.7656 15.9063 79.8125 17.875 80.5312 20.25C81.25 22.5938 81.5 25.3438 81.2812 28.5C81.1562 30.3125 80.7812 32.2031 80.1562 34.1719C79.5625 36.1094 78.7656 38.0156 77.7656 39.8906C76.7969 41.7656 75.6406 43.5469 74.2969 45.2344C72.9531 46.9219 71.4844 48.3906 69.8906 49.6406C68.2969 50.9219 66.5938 51.9219 64.7812 52.6406C62.9688 53.3906 61.0938 53.7656 59.1562 53.7656C58.5625 53.7344 57.9219 53.625 57.2344 53.4375C56.6406 53.2812 55.9688 53.0156 55.2188 52.6406C54.4688 52.2656 53.6875 51.7344 52.875 51.0469ZM96.9375 37.5469C96.625 38.7344 96.2031 39.8438 95.6719 40.875C95.1406 41.9062 94.5 42.7969 93.75 43.5469C93.0312 44.2969 92.2031 44.875 91.2656 45.2812C90.3594 45.7188 89.3594 45.9375 88.2656 45.9375C86.9844 45.9375 85.9688 45.6562 85.2188 45.0938C84.5 44.5625 83.9531 43.8906 83.5781 43.0781C83.2344 42.2656 83.0312 41.375 82.9688 40.4062C82.875 39.4375 82.8281 38.5312 82.8281 37.6875C82.8281 37.0938 82.9062 36.4375 83.0625 35.7188C83.1875 35 83.375 34.2656 83.625 33.5156C83.875 32.7656 84.1875 32.0156 84.5625 31.2656C84.9688 30.5156 85.4375 29.8281 85.9688 29.2031C86.1562 28.6719 86.4375 28.2031 86.8125 27.7969C87.2188 27.3906 87.6719 27.0625 88.1719 26.8125C88.7031 26.5312 89.2656 26.3281 89.8594 26.2031C90.4531 26.0469 91.0312 25.9688 91.5938 25.9688C91.6875 25.9688 91.7656 25.9844 91.8281 26.0156C91.9219 26.0469 92.0156 26.0781 92.1094 26.1094C92.5156 26.1406 93.0156 26.2969 93.6094 26.5781C94.2344 26.8594 94.8281 27.2812 95.3906 27.8438C95.9844 28.4062 96.4844 29.125 96.8906 30C97.2969 30.8438 97.5 31.875 97.5 33.0938C97.5 33.3438 97.4844 33.6562 97.4531 34.0312C97.4219 34.375 97.3906 34.6719 97.3594 34.9219C98.0781 34.6406 98.8281 34.2969 99.6094 33.8906C100.391 33.4844 101.141 33.0625 101.859 32.625C102.609 32.1562 103.297 31.6875 103.922 31.2188C104.547 30.75 105.047 30.3281 105.422 29.9531C105.734 29.6719 106 29.5156 106.219 29.4844C106.438 29.4531 106.594 29.5156 106.688 29.6719C106.781 29.8281 106.797 30.0469 106.734 30.3281C106.672 30.6094 106.5 30.9219 106.219 31.2656C106.062 31.4531 105.656 31.8281 105 32.3906C104.375 32.9531 103.625 33.5625 102.75 34.2188C101.875 34.875 100.922 35.5156 99.8906 36.1406C98.8594 36.7656 97.875 37.2344 96.9375 37.5469ZM89.0156 30.4219C88.9219 30.7031 88.875 31 88.875 31.3125C88.875 31.8125 88.9062 32.3438 88.9688 32.9062C89.0312 33.4375 89.1875 33.9219 89.4375 34.3594C89.6875 34.7969 90.0781 35.1719 90.6094 35.4844C91.1719 35.7656 91.9375 35.9062 92.9062 35.9062C93.0625 35.9062 93.2188 35.9062 93.375 35.9062C93.5312 35.875 93.6875 35.8438 93.8438 35.8125C93.9375 35.4062 94.0156 35.0469 94.0781 34.7344C94.1719 34.3906 94.2188 34.0938 94.2188 33.8438C94.2812 33.25 94.2812 32.6406 94.2188 32.0156C94.1562 31.3906 94.0312 30.8281 93.8438 30.3281C93.6875 29.7969 93.4688 29.375 93.1875 29.0625C92.9375 28.7188 92.625 28.5469 92.25 28.5469C91.6562 28.5469 91.0781 28.7188 90.5156 29.0625C89.9844 29.375 89.4844 29.8281 89.0156 30.4219ZM86.0156 38.6719C86.0156 39.2344 86.0469 39.7969 86.1094 40.3594C86.1719 40.8906 86.2969 41.375 86.4844 41.8125C86.6719 42.2188 86.9219 42.5625 87.2344 42.8438C87.5469 43.0938 87.9531 43.2188 88.4531 43.2188C89.0156 43.2188 89.5312 43.0938 90 42.8438C90.4688 42.5625 90.8906 42.2188 91.2656 41.8125C91.6406 41.375 91.9688 40.8906 92.25 40.3594C92.5625 39.7969 92.8281 39.2188 93.0469 38.625C92.8281 38.6562 92.6094 38.6875 92.3906 38.7188C92.2031 38.7188 91.9844 38.7188 91.7344 38.7188C90.5469 38.7188 89.5156 38.375 88.6406 37.6875C87.7969 36.9688 87.1406 36.0625 86.6719 34.9688C86.4844 35.625 86.3281 36.2656 86.2031 36.8906C86.0781 37.5156 86.0156 38.1094 86.0156 38.6719Z" fill="white"/><line y1="61.5" x2="118" y2="61.5" stroke="white" stroke-width="3"/></svg>
                </b-navbar-brand>

                <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>

                <b-collapse id="nav-collapse" class="header__menu" is-nav>
                <b-navbar-nav class="header__menu-list">
                    <b-nav-item to=/>Главная</b-nav-item>
                    <b-nav-item to=/dashboard>Кабинет</b-nav-item>
                    <b-nav-item to=/register>Регистрация</b-nav-item>
                    <b-nav-item to=/login>Вход</b-nav-item>
                </b-navbar-nav>
                <b-navbar-nav class="ml-auto" v-if="$store.state.isLoggedIn">
                    <b-nav-item-dropdown right>
                    <template #button-content>
                        <em>{{$store.state.profile.name}}</em>
                    </template>
                    <b-dropdown-item v-on:click="logout">Выйти</b-dropdown-item>
                    </b-nav-item-dropdown>
                </b-navbar-nav>
                </b-collapse>
            </div>
        </b-navbar>
    </div>
</template>

<style>
    .header__nav {
        background-color: #6fa7a1;
        box-shadow: 0px 4px 20px rgb(0 0 0 / 9%);
        position: relative;
        z-index: 3;
        padding: 8px 0;
    }

    .header__menu-list {
        width: 100%;
    }

    .header__menu-list .nav-item a {
        color: #fff;
    }

    .header__logo {
        height: 45px;
    }
    
</style>

<script>
    import * as auth from '../services/auth_service';
    import * as tasks from '../services/list_service';
    export default {
        data: function() {
            return {
                isLoggedIn: auth.isLoggedIn()
            }
        },
        created: async function() {
            try {
                if (auth.isLoggedIn()) {
                    const response = await auth.getProfile();
                    this.$store.dispatch('authenticate', response.data);
                    this.reloadTasks();
                }
            } catch (error) {
                auth.logout();
            }
        },
        methods: {
            logout: async function() {
                auth.logout();
                this.$store.dispatch('tasksSet', {});
                this.$store.dispatch('authenticate', {});
                this.$router.push('/login');
            },
            reloadTasks: async function() {
                try {
                    const response = await tasks.getTasks(this.$store.state.profile.id);
                    this.$store.dispatch('tasksSet', response.data);
                } catch (error) {
                    
                }
            }
        }
    }
</script>
